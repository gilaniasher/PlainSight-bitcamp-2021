let data = `{"data":[{"position":[{"x":346,"y":149},{"x":697,"y":149},{"x":697,"y":525},{"x":346,"y":525}],"recodnition":{"responses":[{"webDetection":{"bestGuessLabels":[{"label":"man"}],"fullMatchingImages":[{"url":"https://media-exp1.licdn.com/dms/image/C4D03AQEkqU4mYQeJSg/profile-displayphoto-shrink_200_200/0/1516940199591?e=1617840000&v=beta&t=09NlEtqEOF30UM3j8xjUvjHKw3YepdSGMtTCuobMR9A"},{"url":"https://radaris.com/i/f779239fe10c6b5bfafab241a947d08b"}],"pagesWithMatchingImages":[{"pageTitle":"Getting Back to \u201cWe\u201d. This week: a conversation with Robert\u2026 | by ...","partialMatchingImages":[{"url":"https://miro.medium.com/max/2400/1*l4cEUviu_SCM4OIHElaV_Q.jpeg"}],"url":"https://medium.com/@RadioOpenSource/getting-back-to-we-bbe959655615"},{"pageTitle":"Mitt Romney: A True American Patriot \u2013 Keith C. Milne","partialMatchingImages":[{"url":"https://i0.wp.com/keithmilne.com/wp-content/uploads/2020/04/440px-Mitt_Romney_official_US_Senate_portrait-1.jpg?resize=440%2C510&ssl=1"}],"url":"https://keithmilne.com/2020/04/24/mitt-romney-a-true-american-patriot/"},{"pageTitle":"China&#39;s Rise Demands a Renewed Brand of American Diplomacy ...","partialMatchingImages":[{"url":"https://aspenideasfestival.imgix.net/null486d9ae7-ccc6-4260-80fc-2db934d8a47b/Romney_Mitt_AIF2020.jpg?auto=compress%2Cformat&fit=min&fm=jpg&q=80&rect=102%2C18%2C1323%2C1326&w=200"}],"url":"https://www.aspenideas.org/index.php/sessions/chinas-rise-demands-a-renewed-brand-of-american-diplomacy"},{"pageTitle":"2016 Afternoon of Conversation | Aspen Ideas","partialMatchingImages":[{"url":"https://aspenideasfestival.imgix.net/null486d9ae7-ccc6-4260-80fc-2db934d8a47b/Romney_Mitt_AIF2020.jpg?auto=compress%2Cformat&fit=min&fm=jpg&q=80&rect=102%2C18%2C1323%2C1326&w=200"}],"url":"https://aspenideas.org/sessions/2016-afternoon-of-conversation"},{"fullMatchingImages":[{"url":"https://media-exp1.licdn.com/dms/image/C4D03AQEkqU4mYQeJSg/profile-displayphoto-shrink_200_200/0/1516940199591?e=1617840000&v=beta&t=09NlEtqEOF30UM3j8xjUvjHKw3YepdSGMtTCuobMR9A"}],"pageTitle":"John &quot;Jack&quot; Cummings Cummings - President - President ... - LinkedIn","url":"https://www.linkedin.com/in/john-jack-cummings-cummings-95344721"},{"pageTitle":"Mitt Romney (Governor of Massachusetts and US Senator) - On This ...","partialMatchingImages":[{"url":"https://www.onthisday.com/images/people/mitt-romney-medium.jpg"}],"url":"https://www.onthisday.com/people/mitt-romney"},{"fullMatchingImages":[{"url":"https://media-exp1.licdn.com/dms/image/C4D03AQEkqU4mYQeJSg/profile-displayphoto-shrink_200_200/0/1516940199591?e=1622678400&v=beta&t=jSEP2wB1hemg3kfQ1Q_cNvVVnNkDEo4dha4y2PwiKHo"}],"pageTitle":"100+ &quot;Jack Cummings&quot; profiles | LinkedIn","url":"https://www.linkedin.com/pub/dir/Jack/Cummings"},{"fullMatchingImages":[{"url":"https://media-exp1.licdn.com/dms/image/C4D03AQEkqU4mYQeJSg/profile-displayphoto-shrink_200_200/0/1516940199591?e=1620259200&v=beta&t=ih__afr8aGjSrZNFVszg3mx_uM3GiPaApMu_jKZyBGs"}],"pageTitle":"100+ &quot;Cummings Cummings&quot; profiles | LinkedIn","url":"https://www.linkedin.com/pub/dir/Cummings/Cummings"},{"pageTitle":"Aspen Ideas 2020: Mitt Romney, Alicia Garza, Michael Eric Dyson ...","partialMatchingImages":[{"url":"https://aspenideasfestival.imgix.net/null486d9ae7-ccc6-4260-80fc-2db934d8a47b/Romney_Mitt_AIF2020.jpg?auto=compress%2Cformat&fit=min&fm=jpg&q=80&rect=102%2C18%2C1323%2C1326&w=200"}],"url":"https://aspenideas.org/collections/aspen-ideas-2020-mitt-romney-alicia-garza-michael-eric-dyson-brian-greene-and-lulu-miller"},{"pageTitle":"China&#39;s Rise Demands a Renewed Brand of American Diplomacy ...","partialMatchingImages":[{"url":"https://aspenideasfestival.imgix.net/null486d9ae7-ccc6-4260-80fc-2db934d8a47b/Romney_Mitt_AIF2020.jpg?auto=compress%2Cformat&fit=min&fm=jpg&q=80&rect=102%2C18%2C1323%2C1326&w=200"}],"url":"https://admin.aspenideas.org/sessions/chinas-rise-demands-a-renewed-brand-of-american-diplomacy"}],"partialMatchingImages":[{"url":"https://aspenideasfestival.imgix.net/null486d9ae7-ccc6-4260-80fc-2db934d8a47b/Romney_Mitt_AIF2020.jpg?auto=compress%2Cformat&fit=min&fm=jpg&q=80&rect=102%2C18%2C1323%2C1326&w=200"},{"url":"https://www.onthisday.com/images/people/mitt-romney-medium.jpg"},{"url":"https://img.17qq.com/images/mqsmfsphsy.jpeg"},{"url":"https://i0.wp.com/keithmilne.com/wp-content/uploads/2020/04/440px-Mitt_Romney_official_US_Senate_portrait-1.jpg?resize=440%2C510&ssl=1"},{"url":"https://miro.medium.com/max/2400/1*l4cEUviu_SCM4OIHElaV_Q.jpeg"},{"url":"https://pbs.twimg.com/media/EtCd56NXUAc37j6.jpg"},{"url":"https://lookaside.fbsbx.com/lookaside/crawler/media/?media_id=3420324744663165"},{"url":"https://aspire.usu.edu/images/endorsements/romney-mitt.jpg"},{"url":"http://www.globesocialnetwork.com/wp-content/uploads/2020/05/MITTROMNEY-440x264.jpg"},{"url":"https://i0.hdslb.com/bfs/album/58ec328efe040a29a5b83c7c75782642317d618f.jpg"}],"visuallySimilarImages":[{"url":"https://images.stockfreeimages.com/199/sfi226w/1992524.jpg"},{"url":"https://images.stockfreeimages.com/199/sfi226w/1992537.jpg"},{"url":"https://www.irishtimes.com/polopoly_fs/1.2120717.1425072910!/image/image.jpg_gen/derivatives/ratio_1x1_w1200/image.jpg"},{"url":"https://www.denofgeek.com/wp-content/uploads/2015/11/lee_majors.jpg?resize=400%2C371"},{"url":"https://www.smilecreations4u.com/assets/images/makeovers_21fa_lg.jpg"},{"url":"https://www.gannett-cdn.com/-mm-/cea6d2ff470eae2e1fb7981c5aa147b52c969b4b/c=13-0-394-508/local/-/media/2017/10/06/DetroitFreeP/DetroitFreePress/636428939011058716-kurtis.JPG?width=300&height=400&fit=crop&format=pjpg&auto=webp"},{"url":"https://jacksoncreekdental.com/wp-content/uploads/jim-smile.jpg"},{"url":"https://cdn.thecosmeticdentistsofaustin.com/wp-content/uploads/2018/11/smile-makeover-696-696.jpg"},{"url":"https://images1.westend61.de/0000054497l/portrait-of-a-man-close-up-MUF00560.jpg"},{"url":"https://images.westend61.de/0000054480l/man-looking-sad-close-up-portrait-MUF00577.jpg"}],"webEntities":[{"description":"United States","entityId":"/m/09c7w0","score":0.66645},{"description":"Dead Man's Medal","entityId":"/m/06k7dcx","score":0.6591},{"description":"United States presidential election, 2012","entityId":"/m/0g4_c19","score":0.52155},{"entityId":"/t/26tx7xy9_tgvr","score":0.512},{"description":"President of the United States","entityId":"/m/060d2","score":0.4774},{"description":"Once a Legend","entityId":"/g/12bn3_19k","score":0.43035},{"entityId":"/t/2dgg60z74vt0","score":0.3906},{"description":"Businessperson","entityId":"/m/012t_z","score":0.3111},{"description":"Governor","entityId":"/m/0fkvn","score":0.2916},{"description":"Jack Cummings","entityId":"/g/11f1s2fw_t","score":0.083805}]}}]}},{"position":[{"x":968,"y":138},{"x":1273,"y":138},{"x":1273,"y":466},{"x":968,"y":466}],"recodnition":{"responses":[{"webDetection":{"bestGuessLabels":[{"label":"person"}],"pagesWithMatchingImages":[{"pageTitle":"Google&#39;s Sundar Pichai&#39;s 9 Biggest Statements At Tech Hearing - CRN","partialMatchingImages":[{"url":"https://www.crn.com/resources/0262-10b8c940403a-8ed6bd85a429-1000/index_20201028194211.cfm.jpeg"}],"url":"https://www.crn.com/slide-shows/cloud/google-s-sundar-pichai-s-9-biggest-statements-at-tech-hearing/10"},{"pageTitle":"Utah&#39;s Senators respond to Trump&#39;s nomination of Barrett for ...","partialMatchingImages":[{"url":"https://ewscripps.brightspotcdn.com/d7/61/392edeed46b0aebd1524b5c93b3e/lee-romney.jpg"}],"url":"https://www.fox13now.com/news/politics/utahs-senators-respond-to-trumps-nomination-of-barrett-for-supreme-court"},{"pageTitle":"Health \u2013 Page 5 \u2013 News Archy UK","partialMatchingImages":[{"url":"https://i0.wp.com/media.telemundoutah.com/2020/10/MikeLeeDef.jpg?ssl=1"}],"url":"https://www.newsarchyuk.com/category/health/page/5/"},{"pageTitle":"Past Speakers \u2013 FreedomFest","partialMatchingImages":[{"url":"http://www.freedomfest.com/wp-content/uploads/2020/12/Sen-Mike-Lee.jpg"}],"url":"http://www.freedomfest.com/past-speakers/"},{"pageTitle":"uk \u2013 Page 8619 \u2013 News Archy UK","partialMatchingImages":[{"url":"https://i0.wp.com/media.telemundoutah.com/2020/10/MikeLeeDef.jpg?ssl=1"}],"url":"https://www.newsarchyuk.com/author/drbyos/page/8619/"},{"pageTitle":"How are members of the United States Senate chosen? - Quora","partialMatchingImages":[{"url":"https://qph.fs.quoracdn.net/main-qimg-1ea5bd053a1ba37454707f64938f9788"}],"url":"https://www.quora.com/How-are-members-of-the-United-States-Senate-chosen"},{"pageTitle":"What would happen if the United States passed a law that made ...","partialMatchingImages":[{"url":"https://qph.fs.quoracdn.net/main-qimg-1ea5bd053a1ba37454707f64938f9788"}],"url":"https://www.quora.com/What-would-happen-if-the-United-States-passed-a-law-that-made-Congress-and-the-Senate-hereditary-titles"},{"pageTitle":"If you could take just one member of the US Congress out on a date ...","partialMatchingImages":[{"url":"https://qph.fs.quoracdn.net/main-qimg-1ea5bd053a1ba37454707f64938f9788"}],"url":"https://www.quora.com/If-you-could-take-just-one-member-of-the-US-Congress-out-on-a-date-house-or-senate-which-one-would-it-to-be-and-why"},{"pageTitle":"Is the US Senate an effective entity, or is it time for a reform in the US ...","partialMatchingImages":[{"url":"https://qph.fs.quoracdn.net/main-qimg-1ea5bd053a1ba37454707f64938f9788"}],"url":"https://www.quora.com/Is-the-US-Senate-an-effective-entity-or-is-it-time-for-a-reform-in-the-US-government"},{"pageTitle":"What branch of the U.S. government does the Senate belong to ...","partialMatchingImages":[{"url":"https://qph.fs.quoracdn.net/main-qimg-1ea5bd053a1ba37454707f64938f9788"}],"url":"https://www.quora.com/What-branch-of-the-U-S-government-does-the-Senate-belong-to"}],"partialMatchingImages":[{"url":"http://www.freedomfest.com/wp-content/uploads/2020/12/Sen-Mike-Lee.jpg"},{"url":"https://qph.fs.quoracdn.net/main-qimg-1ea5bd053a1ba37454707f64938f9788"},{"url":"https://i0.wp.com/media.telemundoutah.com/2020/10/MikeLeeDef.jpg?ssl=1"},{"url":"https://ewscripps.brightspotcdn.com/d7/61/392edeed46b0aebd1524b5c93b3e/lee-romney.jpg"},{"url":"https://www.crn.com/resources/0262-10b8c940403a-8ed6bd85a429-1000/index_20201028194211.cfm.jpeg"},{"url":"https://i.pinimg.com/474x/88/7e/46/887e466a0fbedfa98981168d61141f42.jpg"},{"url":"https://img.17qq.com/images/eiojdhz.jpeg"},{"url":"https://politica.estadao.com.br/blogs/crop/1200x675/fausto-macedo/wp-content/uploads/sites/41/2020/03/andre_200320200826.jpg"},{"url":"https://profile-images.xing.com/images/df92acfe56c10926e7eced8a08872f8b-4/felix-wiesel.256x256.jpg"},{"url":"https://m.media-amazon.com/images/M/MV5BZDc1YmFlYjYtMjZjYi00YmE2LWFiODItNDY2ZDg3MDE3MmY3XkEyXkFqcGdeQXVyODI5MjY4NjI@._V1_FMjpg_UX1000_.jpg"}],"visuallySimilarImages":[{"url":"https://dallascosmeticdentist.us/wp-content/uploads/p2-before.jpg"},{"url":"https://www.tcdmadison.com/Content/files/BeforeAfter/JTNewSmile.jpg"},{"url":"https://dallascosmeticdentist.us/wp-content/uploads/p2-after.jpg"},{"url":"https://cdn.thecosmeticdentistsofaustin.com/wp-content/uploads/2018/11/smile-makeover-696-696.jpg"},{"url":"https://www.famousbirthdays.com/faces/kors-michael-image.jpg"},{"url":"https://jacksoncreekdental.com/wp-content/uploads/jim-smile.jpg"},{"url":"https://lookaside.fbsbx.com/lookaside/crawler/media/?media_id=3387611581306927"},{"url":"https://i.pinimg.com/originals/ff/e0/5e/ffe05e7780bc884094586f661442973b.jpg"},{"url":"https://www.smilecreations4u.com/assets/images/sotm_june_2018af.jpg"},{"url":"https://www.smilemoredentalaz.com/wp-content/uploads/2018/06/smile-more-13.jpg"}],"webEntities":[{"description":"Mike Lee","entityId":"/m/09v5q9x","score":10.609501},{"description":"United States","entityId":"/m/09c7w0","score":0.75045},{"entityId":"/t/26tx7xy9_tgvr","score":0.5003},{"entityId":"/t/2ggf2vrwftl3n","score":0.3974},{"entityId":"/t/2559cfx2jwyf6","score":0.338},{"entityId":"/t/26pdh2sdh084q","score":0.254},{"description":"Brett Kavanaugh","entityId":"/m/08dd9b","score":0.053579997},{"description":"Patty Murray","entityId":"/m/018qx5","score":0.05133},{"description":"Neil Gorsuch","entityId":"/m/0fmj17","score":0.04014},{"description":"Sundar Pichai","entityId":"/m/09gds74","score":0.038325}]}}]}}]}`

chrome.runtime.onInstalled.addListener(function() {
    chrome.browserAction.onClicked.addListener(function(tab) {
        chrome.tabs.captureVisibleTab(function(screenshotUrl) {

            console.log(tab)
            let messageSender = chrome.tabs.sendMessage

            /*setTimeout(()=>{
                messageSender(tab.id, {msg: "results", results: JSON.parse(data)}, function(response) {})
            }, 1000)*/

            
            fetch("https://us-central1-white-might-262617.cloudfunctions.net/open-bio", {
                method: 'POST',
                body: JSON.stringify({query:screenshotUrl.substr(23)}),
            })
            .then(response => response.json())
            .then(data => {
                chrome.tabs.sendMessage(tab.id, {msg: "results", results: data}, function(response) {})
            }) 

            chrome.tabs.sendMessage(tab.id, {msg: "animation"}, function(response) {});

        });
    });
})
    